<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>zbus: /home/g41797/CLionProjects/github.com/g41797/zbus/src/libs/libubox/base64.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">zbus
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="../../dir_87a455bccb09a92130c26a11a880c98a.html">libs</a></li><li class="navelem"><a class="el" href="../../dir_397c898d2cf76178a72912abd1158536.html">libubox</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">base64.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &lt;ctype.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &quot;<a class="el" href="../../dc/da7/assert_8h_source.html">assert.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d1d/libubox_2utils_8h_source.html">utils.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for base64.c:</div>
<div class="dyncontent">
<div class="center"><img src="../../de/d23/base64_8c__incl.png" border="0" usemap="#a_2home_2g41797_2CLionProjects_2github_8com_2g41797_2zbus_2src_2libs_2libubox_2base64_8c" alt=""/></div>
<map name="a_2home_2g41797_2CLionProjects_2github_8com_2g41797_2zbus_2src_2libs_2libubox_2base64_8c" id="a_2home_2g41797_2CLionProjects_2github_8com_2g41797_2zbus_2src_2libs_2libubox_2base64_8c">
<area shape="rect" title=" " alt="" coords="162,5,448,85"/>
<area shape="rect" title=" " alt="" coords="5,215,133,248"/>
<area shape="poly" title=" " alt="" coords="162,59,123,69,86,85,53,106,26,134,20,151,23,168,31,185,44,202,40,205,27,188,18,169,15,150,21,132,50,102,84,80,121,64,161,53"/>
<area shape="rect" title=" " alt="" coords="36,133,126,167"/>
<area shape="poly" title=" " alt="" coords="220,88,131,129,129,124,218,83"/>
<area shape="rect" title=" " alt="" coords="151,133,235,167"/>
<area shape="poly" title=" " alt="" coords="264,88,223,125,219,121,260,84"/>
<area shape="rect" title=" " alt="" coords="260,133,350,167"/>
<area shape="poly" title=" " alt="" coords="308,86,308,118,302,118,302,86"/>
<area shape="rect" title=" " alt="" coords="374,133,468,167"/>
<area shape="poly" title=" " alt="" coords="351,84,393,121,390,125,348,88"/>
<area shape="rect" href="../../dc/da7/assert_8h.html" title=" " alt="" coords="492,133,588,167"/>
<area shape="poly" title=" " alt="" coords="396,83,490,124,488,129,394,88"/>
<area shape="rect" href="../../d5/d1d/libubox_2utils_8h.html" title=" " alt="" coords="637,133,715,167"/>
<area shape="poly" title=" " alt="" coords="449,82,622,130,621,135,448,87"/>
<area shape="poly" title=" " alt="" coords="589,132,607,137,614,150,612,158,605,164,601,160,607,155,609,150,603,141,588,137"/>
<area shape="poly" title=" " alt="" coords="637,166,624,169,148,224,148,219,623,164,635,161"/>
<area shape="rect" title=" " alt="" coords="228,215,339,248"/>
<area shape="poly" title=" " alt="" coords="637,166,624,169,491,194,355,217,354,212,491,189,623,164,635,161"/>
<area shape="rect" title=" " alt="" coords="364,215,481,248"/>
<area shape="poly" title=" " alt="" coords="637,166,489,212,487,207,635,161"/>
<area shape="rect" title=" " alt="" coords="506,215,598,248"/>
<area shape="poly" title=" " alt="" coords="652,169,591,209,588,204,649,165"/>
<area shape="rect" title=" " alt="" coords="622,215,729,248"/>
<area shape="poly" title=" " alt="" coords="678,167,678,199,673,199,673,167"/>
<area shape="rect" title=" " alt="" coords="754,215,851,248"/>
<area shape="poly" title=" " alt="" coords="703,165,765,204,763,209,700,169"/>
<area shape="rect" title=" " alt="" coords="876,215,956,248"/>
<area shape="poly" title=" " alt="" coords="716,162,862,210,860,215,714,167"/>
<area shape="rect" title=" " alt="" coords="979,215,1167,248"/>
<area shape="poly" title=" " alt="" coords="716,156,978,208,977,214,715,162"/>
</map>
</div>
</div>
<p><a href="../../db/d36/base64_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1a594f917ee0549bcde95ba5be5cf2d3" id="r_a1a594f917ee0549bcde95ba5be5cf2d3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1a594f917ee0549bcde95ba5be5cf2d3">b64_encode</a> (const void *_src, size_t srclength, void *dest, size_t targsize)</td></tr>
<tr class="separator:a1a594f917ee0549bcde95ba5be5cf2d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac696ba547c5b7a5e3b2e3fe54a19ebdd" id="r_ac696ba547c5b7a5e3b2e3fe54a19ebdd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac696ba547c5b7a5e3b2e3fe54a19ebdd">b64_decode</a> (const void *_src, void *dest, size_t targsize)</td></tr>
<tr class="separator:ac696ba547c5b7a5e3b2e3fe54a19ebdd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a90c77759ffd10c703e7d8f93c09a9c3b" id="r_a90c77759ffd10c703e7d8f93c09a9c3b"><td class="memItemLeft" align="right" valign="top">static const char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a90c77759ffd10c703e7d8f93c09a9c3b">Base64</a> []</td></tr>
<tr class="separator:a90c77759ffd10c703e7d8f93c09a9c3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9841eb97064629b21e7894aec41327dd" id="r_a9841eb97064629b21e7894aec41327dd"><td class="memItemLeft" align="right" valign="top">static const char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9841eb97064629b21e7894aec41327dd">Pad64</a> = '='</td></tr>
<tr class="separator:a9841eb97064629b21e7894aec41327dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="ac696ba547c5b7a5e3b2e3fe54a19ebdd" name="ac696ba547c5b7a5e3b2e3fe54a19ebdd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac696ba547c5b7a5e3b2e3fe54a19ebdd">&#9670;&#160;</a></span>b64_decode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int b64_decode </td>
          <td>(</td>
          <td class="paramtype">const void *</td>          <td class="paramname"><span class="paramname"><em>_src</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>dest</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>targsize</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../db/d36/base64_8c_source.html#l00203">203</a> of file <a class="el" href="../../db/d36/base64_8c_source.html">base64.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  204</span>{</div>
<div class="line"><span class="lineno">  205</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *src = _src;</div>
<div class="line"><span class="lineno">  206</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *target = dest;</div>
<div class="line"><span class="lineno">  207</span>    <span class="keywordtype">int</span> <a class="code hl_variable" href="../../dd/d21/lua_2uloop_8c.html#a6d868643f77c65afe8f86ae76bf60641">state</a>, ch;</div>
<div class="line"><span class="lineno">  208</span>    <span class="keywordtype">size_t</span> tarindex;</div>
<div class="line"><span class="lineno">  209</span>    u_char nextbyte;</div>
<div class="line"><span class="lineno">  210</span>    <span class="keywordtype">char</span> *pos;</div>
<div class="line"><span class="lineno">  211</span> </div>
<div class="line"><span class="lineno">  212</span>    <a class="code hl_variable" href="../../dd/d21/lua_2uloop_8c.html#a6d868643f77c65afe8f86ae76bf60641">state</a> = 0;</div>
<div class="line"><span class="lineno">  213</span>    tarindex = 0;</div>
<div class="line"><span class="lineno">  214</span> </div>
<div class="line"><span class="lineno">  215</span>    assert(dest &amp;&amp; targsize &gt; 0);</div>
<div class="line"><span class="lineno">  216</span> </div>
<div class="line"><span class="lineno">  217</span>    <span class="keywordflow">while</span> ((ch = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)*src++) != <span class="charliteral">&#39;\0&#39;</span>) {</div>
<div class="line"><span class="lineno">  218</span>        <span class="keywordflow">if</span> (isspace(ch))    <span class="comment">/* Skip whitespace anywhere. */</span></div>
<div class="line"><span class="lineno">  219</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  220</span> </div>
<div class="line"><span class="lineno">  221</span>        <span class="keywordflow">if</span> (ch == <a class="code hl_variable" href="#a9841eb97064629b21e7894aec41327dd">Pad64</a>)</div>
<div class="line"><span class="lineno">  222</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  223</span> </div>
<div class="line"><span class="lineno">  224</span>        pos = strchr(<a class="code hl_variable" href="#a90c77759ffd10c703e7d8f93c09a9c3b">Base64</a>, ch);</div>
<div class="line"><span class="lineno">  225</span>        <span class="keywordflow">if</span> (pos == 0)       <span class="comment">/* A non-base64 character. */</span></div>
<div class="line"><span class="lineno">  226</span>            <span class="keywordflow">return</span> (-1);</div>
<div class="line"><span class="lineno">  227</span> </div>
<div class="line"><span class="lineno">  228</span>        <span class="keywordflow">switch</span> (<a class="code hl_variable" href="../../dd/d21/lua_2uloop_8c.html#a6d868643f77c65afe8f86ae76bf60641">state</a>) {</div>
<div class="line"><span class="lineno">  229</span>        <span class="keywordflow">case</span> 0:</div>
<div class="line"><span class="lineno">  230</span>            <span class="keywordflow">if</span> (target) {</div>
<div class="line"><span class="lineno">  231</span>                <span class="keywordflow">if</span> (tarindex &gt;= targsize)</div>
<div class="line"><span class="lineno">  232</span>                    <span class="keywordflow">return</span> (-1);</div>
<div class="line"><span class="lineno">  233</span>                target[tarindex] = (pos - <a class="code hl_variable" href="#a90c77759ffd10c703e7d8f93c09a9c3b">Base64</a>) &lt;&lt; 2;</div>
<div class="line"><span class="lineno">  234</span>            }</div>
<div class="line"><span class="lineno">  235</span>            <a class="code hl_variable" href="../../dd/d21/lua_2uloop_8c.html#a6d868643f77c65afe8f86ae76bf60641">state</a> = 1;</div>
<div class="line"><span class="lineno">  236</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  237</span>        <span class="keywordflow">case</span> 1:</div>
<div class="line"><span class="lineno">  238</span>            <span class="keywordflow">if</span> (target) {</div>
<div class="line"><span class="lineno">  239</span>                <span class="keywordflow">if</span> (tarindex &gt;= targsize)</div>
<div class="line"><span class="lineno">  240</span>                    <span class="keywordflow">return</span> (-1);</div>
<div class="line"><span class="lineno">  241</span>                target[tarindex]   |=  (pos - <a class="code hl_variable" href="#a90c77759ffd10c703e7d8f93c09a9c3b">Base64</a>) &gt;&gt; 4;</div>
<div class="line"><span class="lineno">  242</span>                nextbyte = ((pos - <a class="code hl_variable" href="#a90c77759ffd10c703e7d8f93c09a9c3b">Base64</a>) &amp; 0x0f) &lt;&lt; 4;</div>
<div class="line"><span class="lineno">  243</span>                <span class="keywordflow">if</span> (tarindex + 1 &lt; targsize)</div>
<div class="line"><span class="lineno">  244</span>                    target[tarindex+1] = nextbyte;</div>
<div class="line"><span class="lineno">  245</span>                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nextbyte)</div>
<div class="line"><span class="lineno">  246</span>                    <span class="keywordflow">return</span> (-1);</div>
<div class="line"><span class="lineno">  247</span>            }</div>
<div class="line"><span class="lineno">  248</span>            tarindex++;</div>
<div class="line"><span class="lineno">  249</span>            <a class="code hl_variable" href="../../dd/d21/lua_2uloop_8c.html#a6d868643f77c65afe8f86ae76bf60641">state</a> = 2;</div>
<div class="line"><span class="lineno">  250</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  251</span>        <span class="keywordflow">case</span> 2:</div>
<div class="line"><span class="lineno">  252</span>            <span class="keywordflow">if</span> (target) {</div>
<div class="line"><span class="lineno">  253</span>                <span class="keywordflow">if</span> (tarindex &gt;= targsize)</div>
<div class="line"><span class="lineno">  254</span>                    <span class="keywordflow">return</span> (-1);</div>
<div class="line"><span class="lineno">  255</span>                target[tarindex]   |=  (pos - <a class="code hl_variable" href="#a90c77759ffd10c703e7d8f93c09a9c3b">Base64</a>) &gt;&gt; 2;</div>
<div class="line"><span class="lineno">  256</span>                nextbyte = ((pos - <a class="code hl_variable" href="#a90c77759ffd10c703e7d8f93c09a9c3b">Base64</a>) &amp; 0x03) &lt;&lt; 6;</div>
<div class="line"><span class="lineno">  257</span>                <span class="keywordflow">if</span> (tarindex + 1 &lt; targsize)</div>
<div class="line"><span class="lineno">  258</span>                    target[tarindex+1] = nextbyte;</div>
<div class="line"><span class="lineno">  259</span>                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nextbyte)</div>
<div class="line"><span class="lineno">  260</span>                    <span class="keywordflow">return</span> (-1);</div>
<div class="line"><span class="lineno">  261</span>            }</div>
<div class="line"><span class="lineno">  262</span>            tarindex++;</div>
<div class="line"><span class="lineno">  263</span>            <a class="code hl_variable" href="../../dd/d21/lua_2uloop_8c.html#a6d868643f77c65afe8f86ae76bf60641">state</a> = 3;</div>
<div class="line"><span class="lineno">  264</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  265</span>        <span class="keywordflow">case</span> 3:</div>
<div class="line"><span class="lineno">  266</span>            <span class="keywordflow">if</span> (target) {</div>
<div class="line"><span class="lineno">  267</span>                <span class="keywordflow">if</span> (tarindex &gt;= targsize)</div>
<div class="line"><span class="lineno">  268</span>                    <span class="keywordflow">return</span> (-1);</div>
<div class="line"><span class="lineno">  269</span>                target[tarindex] |= (pos - <a class="code hl_variable" href="#a90c77759ffd10c703e7d8f93c09a9c3b">Base64</a>);</div>
<div class="line"><span class="lineno">  270</span>            }</div>
<div class="line"><span class="lineno">  271</span>            tarindex++;</div>
<div class="line"><span class="lineno">  272</span>            <a class="code hl_variable" href="../../dd/d21/lua_2uloop_8c.html#a6d868643f77c65afe8f86ae76bf60641">state</a> = 0;</div>
<div class="line"><span class="lineno">  273</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  274</span>        }</div>
<div class="line"><span class="lineno">  275</span>    }</div>
<div class="line"><span class="lineno">  276</span> </div>
<div class="line"><span class="lineno">  277</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  278</span><span class="comment">     * We are done decoding Base-64 chars.  Let&#39;s see if we ended</span></div>
<div class="line"><span class="lineno">  279</span><span class="comment">     * on a byte boundary, and/or with erroneous trailing characters.</span></div>
<div class="line"><span class="lineno">  280</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">  281</span> </div>
<div class="line"><span class="lineno">  282</span>    <span class="keywordflow">if</span> (ch == <a class="code hl_variable" href="#a9841eb97064629b21e7894aec41327dd">Pad64</a>) {          <span class="comment">/* We got a pad char. */</span></div>
<div class="line"><span class="lineno">  283</span>        ch = (<span class="keywordtype">unsigned</span> char)*src++; <span class="comment">/* Skip it, get next. */</span></div>
<div class="line"><span class="lineno">  284</span>        <span class="keywordflow">switch</span> (<a class="code hl_variable" href="../../dd/d21/lua_2uloop_8c.html#a6d868643f77c65afe8f86ae76bf60641">state</a>) {</div>
<div class="line"><span class="lineno">  285</span>        <span class="keywordflow">case</span> 0:     <span class="comment">/* Invalid = in first position */</span></div>
<div class="line"><span class="lineno">  286</span>        <span class="keywordflow">case</span> 1:     <span class="comment">/* Invalid = in second position */</span></div>
<div class="line"><span class="lineno">  287</span>            <span class="keywordflow">return</span> (-1);</div>
<div class="line"><span class="lineno">  288</span> </div>
<div class="line"><span class="lineno">  289</span>        <span class="keywordflow">case</span> 2:     <span class="comment">/* Valid, means one byte of info */</span></div>
<div class="line"><span class="lineno">  290</span>            <span class="comment">/* Skip any number of spaces. */</span></div>
<div class="line"><span class="lineno">  291</span>            <span class="keywordflow">for</span> (; ch != <span class="charliteral">&#39;\0&#39;</span>; ch = (<span class="keywordtype">unsigned</span> char)*src++)</div>
<div class="line"><span class="lineno">  292</span>                <span class="keywordflow">if</span> (!isspace(ch))</div>
<div class="line"><span class="lineno">  293</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  294</span>            <span class="comment">/* Make sure there is another trailing = sign. */</span></div>
<div class="line"><span class="lineno">  295</span>            <span class="keywordflow">if</span> (ch != <a class="code hl_variable" href="#a9841eb97064629b21e7894aec41327dd">Pad64</a>)</div>
<div class="line"><span class="lineno">  296</span>                <span class="keywordflow">return</span> (-1);</div>
<div class="line"><span class="lineno">  297</span>            ch = (<span class="keywordtype">unsigned</span> char)*src++;     <span class="comment">/* Skip the = */</span></div>
<div class="line"><span class="lineno">  298</span>            <span class="comment">/* Fall through to &quot;single trailing =&quot; case. */</span></div>
<div class="line"><span class="lineno">  299</span>            <span class="comment">/* FALLTHROUGH */</span></div>
<div class="line"><span class="lineno">  300</span> </div>
<div class="line"><span class="lineno">  301</span>        <span class="keywordflow">case</span> 3:     <span class="comment">/* Valid, means two bytes of info */</span></div>
<div class="line"><span class="lineno">  302</span>            <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  303</span><span class="comment">             * We know this char is an =.  Is there anything but</span></div>
<div class="line"><span class="lineno">  304</span><span class="comment">             * whitespace after it?</span></div>
<div class="line"><span class="lineno">  305</span><span class="comment">             */</span></div>
<div class="line"><span class="lineno">  306</span>            <span class="keywordflow">for</span> (; ch != <span class="charliteral">&#39;\0&#39;</span>; ch = (<span class="keywordtype">unsigned</span> char)*src++)</div>
<div class="line"><span class="lineno">  307</span>                <span class="keywordflow">if</span> (!isspace(ch))</div>
<div class="line"><span class="lineno">  308</span>                    <span class="keywordflow">return</span> (-1);</div>
<div class="line"><span class="lineno">  309</span> </div>
<div class="line"><span class="lineno">  310</span>            <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  311</span><span class="comment">             * Now make sure for cases 2 and 3 that the &quot;extra&quot;</span></div>
<div class="line"><span class="lineno">  312</span><span class="comment">             * bits that slopped past the last full byte were</span></div>
<div class="line"><span class="lineno">  313</span><span class="comment">             * zeros.  If we don&#39;t check them, they become a</span></div>
<div class="line"><span class="lineno">  314</span><span class="comment">             * subliminal channel.</span></div>
<div class="line"><span class="lineno">  315</span><span class="comment">             */</span></div>
<div class="line"><span class="lineno">  316</span>            <span class="keywordflow">if</span> (target &amp;&amp; tarindex &lt; targsize &amp;&amp;</div>
<div class="line"><span class="lineno">  317</span>                target[tarindex] != 0)</div>
<div class="line"><span class="lineno">  318</span>                <span class="keywordflow">return</span> (-1);</div>
<div class="line"><span class="lineno">  319</span>        }</div>
<div class="line"><span class="lineno">  320</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  321</span>        <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  322</span><span class="comment">         * We ended by seeing the end of the string.  Make sure we</span></div>
<div class="line"><span class="lineno">  323</span><span class="comment">         * have no partial bytes lying around.</span></div>
<div class="line"><span class="lineno">  324</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">  325</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../dd/d21/lua_2uloop_8c.html#a6d868643f77c65afe8f86ae76bf60641">state</a> != 0)</div>
<div class="line"><span class="lineno">  326</span>            <span class="keywordflow">return</span> (-1);</div>
<div class="line"><span class="lineno">  327</span>    }</div>
<div class="line"><span class="lineno">  328</span> </div>
<div class="line"><span class="lineno">  329</span>    <span class="comment">/* Null-terminate if we have room left */</span></div>
<div class="line"><span class="lineno">  330</span>    <span class="keywordflow">if</span> (tarindex &lt; targsize)</div>
<div class="line"><span class="lineno">  331</span>        target[tarindex] = 0;</div>
<div class="line"><span class="lineno">  332</span> </div>
<div class="line"><span class="lineno">  333</span>    <span class="keywordflow">return</span> (tarindex);</div>
<div class="line"><span class="lineno">  334</span>}</div>
<div class="ttc" id="abase64_8c_html_a90c77759ffd10c703e7d8f93c09a9c3b"><div class="ttname"><a href="#a90c77759ffd10c703e7d8f93c09a9c3b">Base64</a></div><div class="ttdeci">static const char Base64[]</div><div class="ttdef"><b>Definition</b> <a href="../../db/d36/base64_8c_source.html#l00072">base64.c:72</a></div></div>
<div class="ttc" id="abase64_8c_html_a9841eb97064629b21e7894aec41327dd"><div class="ttname"><a href="#a9841eb97064629b21e7894aec41327dd">Pad64</a></div><div class="ttdeci">static const char Pad64</div><div class="ttdef"><b>Definition</b> <a href="../../db/d36/base64_8c_source.html#l00074">base64.c:74</a></div></div>
<div class="ttc" id="alua_2uloop_8c_html_a6d868643f77c65afe8f86ae76bf60641"><div class="ttname"><a href="../../dd/d21/lua_2uloop_8c.html#a6d868643f77c65afe8f86ae76bf60641">state</a></div><div class="ttdeci">static lua_State * state</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d21/lua_2uloop_8c_source.html#l00054">uloop.c:54</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/d36/base64_8c_source.html#l00072">Base64</a>, <a class="el" href="../../db/d36/base64_8c_source.html#l00074">Pad64</a>, and <a class="el" href="../../dd/d21/lua_2uloop_8c_source.html#l00054">state</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../df/daa/test-b64__decode_8c_source.html#l00003">main()</a>, <a class="el" href="../../d6/d13/file_8c_source.html#l00370">rpc_file_write()</a>, and <a class="el" href="../../df/d5f/test-b64_8c_source.html#l00017">test_b64_decode()</a>.</p>

</div>
</div>
<a id="a1a594f917ee0549bcde95ba5be5cf2d3" name="a1a594f917ee0549bcde95ba5be5cf2d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a594f917ee0549bcde95ba5be5cf2d3">&#9670;&#160;</a></span>b64_encode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int b64_encode </td>
          <td>(</td>
          <td class="paramtype">const void *</td>          <td class="paramname"><span class="paramname"><em>_src</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>srclength</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>dest</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>targsize</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../db/d36/base64_8c_source.html#l00139">139</a> of file <a class="el" href="../../db/d36/base64_8c_source.html">base64.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  141</span>{</div>
<div class="line"><span class="lineno">  142</span>    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *src = _src;</div>
<div class="line"><span class="lineno">  143</span>    <span class="keywordtype">char</span> *target = dest;</div>
<div class="line"><span class="lineno">  144</span>    <span class="keywordtype">size_t</span> datalength = 0;</div>
<div class="line"><span class="lineno">  145</span>    u_char input[3] = {0};</div>
<div class="line"><span class="lineno">  146</span>    u_char output[4];</div>
<div class="line"><span class="lineno">  147</span>    <span class="keywordtype">size_t</span> i;</div>
<div class="line"><span class="lineno">  148</span> </div>
<div class="line"><span class="lineno">  149</span>    assert(dest &amp;&amp; targsize &gt; 0);</div>
<div class="line"><span class="lineno">  150</span> </div>
<div class="line"><span class="lineno">  151</span>    <span class="keywordflow">while</span> (2 &lt; srclength) {</div>
<div class="line"><span class="lineno">  152</span>        input[0] = *src++;</div>
<div class="line"><span class="lineno">  153</span>        input[1] = *src++;</div>
<div class="line"><span class="lineno">  154</span>        input[2] = *src++;</div>
<div class="line"><span class="lineno">  155</span>        srclength -= 3;</div>
<div class="line"><span class="lineno">  156</span> </div>
<div class="line"><span class="lineno">  157</span>        output[0] = input[0] &gt;&gt; 2;</div>
<div class="line"><span class="lineno">  158</span>        output[1] = ((input[0] &amp; 0x03) &lt;&lt; 4) + (input[1] &gt;&gt; 4);</div>
<div class="line"><span class="lineno">  159</span>        output[2] = ((input[1] &amp; 0x0f) &lt;&lt; 2) + (input[2] &gt;&gt; 6);</div>
<div class="line"><span class="lineno">  160</span>        output[3] = input[2] &amp; 0x3f;</div>
<div class="line"><span class="lineno">  161</span> </div>
<div class="line"><span class="lineno">  162</span>        <span class="keywordflow">if</span> (datalength + 4 &gt; targsize)</div>
<div class="line"><span class="lineno">  163</span>            <span class="keywordflow">return</span> (-1);</div>
<div class="line"><span class="lineno">  164</span>        target[datalength++] = <a class="code hl_variable" href="#a90c77759ffd10c703e7d8f93c09a9c3b">Base64</a>[output[0]];</div>
<div class="line"><span class="lineno">  165</span>        target[datalength++] = <a class="code hl_variable" href="#a90c77759ffd10c703e7d8f93c09a9c3b">Base64</a>[output[1]];</div>
<div class="line"><span class="lineno">  166</span>        target[datalength++] = <a class="code hl_variable" href="#a90c77759ffd10c703e7d8f93c09a9c3b">Base64</a>[output[2]];</div>
<div class="line"><span class="lineno">  167</span>        target[datalength++] = <a class="code hl_variable" href="#a90c77759ffd10c703e7d8f93c09a9c3b">Base64</a>[output[3]];</div>
<div class="line"><span class="lineno">  168</span>    }</div>
<div class="line"><span class="lineno">  169</span> </div>
<div class="line"><span class="lineno">  170</span>    <span class="comment">/* Now we worry about padding. */</span></div>
<div class="line"><span class="lineno">  171</span>    <span class="keywordflow">if</span> (0 != srclength) {</div>
<div class="line"><span class="lineno">  172</span>        <span class="comment">/* Get what&#39;s left. */</span></div>
<div class="line"><span class="lineno">  173</span>        input[0] = input[1] = input[2] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  174</span>        <span class="keywordflow">for</span> (i = 0; i &lt; srclength; i++)</div>
<div class="line"><span class="lineno">  175</span>            input[i] = *src++;</div>
<div class="line"><span class="lineno">  176</span> </div>
<div class="line"><span class="lineno">  177</span>        output[0] = input[0] &gt;&gt; 2;</div>
<div class="line"><span class="lineno">  178</span>        output[1] = ((input[0] &amp; 0x03) &lt;&lt; 4) + (input[1] &gt;&gt; 4);</div>
<div class="line"><span class="lineno">  179</span>        output[2] = ((input[1] &amp; 0x0f) &lt;&lt; 2) + (input[2] &gt;&gt; 6);</div>
<div class="line"><span class="lineno">  180</span> </div>
<div class="line"><span class="lineno">  181</span>        <span class="keywordflow">if</span> (datalength + 4 &gt; targsize)</div>
<div class="line"><span class="lineno">  182</span>            <span class="keywordflow">return</span> (-1);</div>
<div class="line"><span class="lineno">  183</span>        target[datalength++] = <a class="code hl_variable" href="#a90c77759ffd10c703e7d8f93c09a9c3b">Base64</a>[output[0]];</div>
<div class="line"><span class="lineno">  184</span>        target[datalength++] = <a class="code hl_variable" href="#a90c77759ffd10c703e7d8f93c09a9c3b">Base64</a>[output[1]];</div>
<div class="line"><span class="lineno">  185</span>        <span class="keywordflow">if</span> (srclength == 1)</div>
<div class="line"><span class="lineno">  186</span>            target[datalength++] = <a class="code hl_variable" href="#a9841eb97064629b21e7894aec41327dd">Pad64</a>;</div>
<div class="line"><span class="lineno">  187</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  188</span>            target[datalength++] = <a class="code hl_variable" href="#a90c77759ffd10c703e7d8f93c09a9c3b">Base64</a>[output[2]];</div>
<div class="line"><span class="lineno">  189</span>        target[datalength++] = <a class="code hl_variable" href="#a9841eb97064629b21e7894aec41327dd">Pad64</a>;</div>
<div class="line"><span class="lineno">  190</span>    }</div>
<div class="line"><span class="lineno">  191</span>    <span class="keywordflow">if</span> (datalength &gt;= targsize)</div>
<div class="line"><span class="lineno">  192</span>        <span class="keywordflow">return</span> (-1);</div>
<div class="line"><span class="lineno">  193</span>    target[datalength] = <span class="charliteral">&#39;\0&#39;</span>;  <span class="comment">/* Returned value doesn&#39;t count \0. */</span></div>
<div class="line"><span class="lineno">  194</span>    <span class="keywordflow">return</span> (datalength);</div>
<div class="line"><span class="lineno">  195</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/d36/base64_8c_source.html#l00072">Base64</a>, and <a class="el" href="../../db/d36/base64_8c_source.html#l00074">Pad64</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d0/df3/test-b64__encode_8c_source.html#l00003">main()</a>, <a class="el" href="../../d6/d13/file_8c_source.html#l00289">rpc_file_read()</a>, and <a class="el" href="../../df/d5f/test-b64_8c_source.html#l00009">test_b64_encode()</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a90c77759ffd10c703e7d8f93c09a9c3b" name="a90c77759ffd10c703e7d8f93c09a9c3b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90c77759ffd10c703e7d8f93c09a9c3b">&#9670;&#160;</a></span>Base64</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const char Base64[]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">=</div>
<div class="line">    <span class="stringliteral">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="../../db/d36/base64_8c_source.html#l00072">72</a> of file <a class="el" href="../../db/d36/base64_8c_source.html">base64.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../db/d36/base64_8c_source.html#l00203">b64_decode()</a>, and <a class="el" href="../../db/d36/base64_8c_source.html#l00139">b64_encode()</a>.</p>

</div>
</div>
<a id="a9841eb97064629b21e7894aec41327dd" name="a9841eb97064629b21e7894aec41327dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9841eb97064629b21e7894aec41327dd">&#9670;&#160;</a></span>Pad64</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const char Pad64 = '='</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../db/d36/base64_8c_source.html#l00074">74</a> of file <a class="el" href="../../db/d36/base64_8c_source.html">base64.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../db/d36/base64_8c_source.html#l00203">b64_decode()</a>, and <a class="el" href="../../db/d36/base64_8c_source.html#l00139">b64_encode()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
