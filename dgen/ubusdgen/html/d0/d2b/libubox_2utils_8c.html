<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>zbus: /home/g41797/CLionProjects/github.com/g41797/zbus/src/libs/libubox/utils.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">zbus
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="../../dir_87a455bccb09a92130c26a11a880c98a.html">libs</a></li><li class="navelem"><a class="el" href="../../dir_397c898d2cf76178a72912abd1158536.html">libubox</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">utils.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;sys/mman.h&gt;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;stdarg.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d1d/libubox_2utils_8h_source.html">utils.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for utils.c:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/d7c/libubox_2utils_8c__incl.png" border="0" usemap="#a_2home_2g41797_2CLionProjects_2github_8com_2g41797_2zbus_2src_2libs_2libubox_2utils_8c" alt=""/></div>
<map name="a_2home_2g41797_2CLionProjects_2github_8com_2g41797_2zbus_2src_2libs_2libubox_2utils_8c" id="a_2home_2g41797_2CLionProjects_2github_8com_2g41797_2zbus_2src_2libs_2libubox_2utils_8c">
<area shape="rect" title=" " alt="" coords="302,5,588,85"/>
<area shape="rect" title=" " alt="" coords="5,133,141,167"/>
<area shape="poly" title=" " alt="" coords="303,88,147,131,146,126,302,83"/>
<area shape="rect" title=" " alt="" coords="165,133,253,167"/>
<area shape="poly" title=" " alt="" coords="355,88,261,129,259,124,353,83"/>
<area shape="rect" title=" " alt="" coords="277,133,376,167"/>
<area shape="poly" title=" " alt="" coords="401,88,358,125,355,121,398,84"/>
<area shape="rect" title=" " alt="" coords="400,133,490,167"/>
<area shape="poly" title=" " alt="" coords="448,86,448,118,442,118,442,86"/>
<area shape="rect" title=" " alt="" coords="515,133,599,167"/>
<area shape="poly" title=" " alt="" coords="490,84,531,121,527,125,486,88"/>
<area shape="rect" title=" " alt="" coords="624,133,717,167"/>
<area shape="poly" title=" " alt="" coords="533,83,622,124,620,129,530,88"/>
<area shape="rect" href="../../d5/d1d/libubox_2utils_8h.html" title=" " alt="" coords="741,133,819,167"/>
<area shape="poly" title=" " alt="" coords="574,83,726,129,725,134,573,88"/>
<area shape="rect" title=" " alt="" coords="241,215,353,248"/>
<area shape="poly" title=" " alt="" coords="741,167,730,169,630,187,551,195,471,203,369,217,368,212,470,197,550,190,629,182,728,164,739,161"/>
<area shape="rect" title=" " alt="" coords="377,215,505,248"/>
<area shape="poly" title=" " alt="" coords="741,166,730,169,520,216,519,211,728,164,739,161"/>
<area shape="rect" title=" " alt="" coords="529,215,646,248"/>
<area shape="poly" title=" " alt="" coords="742,170,641,211,639,206,740,165"/>
<area shape="rect" title=" " alt="" coords="671,215,763,248"/>
<area shape="poly" title=" " alt="" coords="769,169,741,204,737,201,765,165"/>
<area shape="rect" title=" " alt="" coords="787,215,895,248"/>
<area shape="poly" title=" " alt="" coords="794,166,821,201,817,204,790,169"/>
<area shape="rect" title=" " alt="" coords="919,215,1016,248"/>
<area shape="poly" title=" " alt="" coords="819,165,917,206,915,211,817,170"/>
<area shape="rect" title=" " alt="" coords="1041,215,1121,248"/>
<area shape="poly" title=" " alt="" coords="820,158,1026,211,1025,216,818,163"/>
<area shape="rect" title=" " alt="" coords="1145,215,1332,248"/>
<area shape="poly" title=" " alt="" coords="820,155,1130,209,1129,214,819,161"/>
</map>
</div>
</div>
<p><a href="../../d0/d2b/libubox_2utils_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:abfdb4e7955090760555ef1a81641db01" id="r_abfdb4e7955090760555ef1a81641db01"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abfdb4e7955090760555ef1a81641db01">foreach_arg</a>(_arg,  _addr,  _len,  _first_addr,  _first_len)</td></tr>
<tr class="separator:abfdb4e7955090760555ef1a81641db01"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac75d395c5362b1ab5bfa39b46c2a318b" id="r_ac75d395c5362b1ab5bfa39b46c2a318b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac75d395c5362b1ab5bfa39b46c2a318b">C_PTR_ALIGN</a>&#160;&#160;&#160;(sizeof(size_t))</td></tr>
<tr class="separator:ac75d395c5362b1ab5bfa39b46c2a318b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afeae6138da019624fe8e5db69a5af620" id="r_afeae6138da019624fe8e5db69a5af620"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afeae6138da019624fe8e5db69a5af620">C_PTR_MASK</a>&#160;&#160;&#160;(-<a class="el" href="#ac75d395c5362b1ab5bfa39b46c2a318b">C_PTR_ALIGN</a>)</td></tr>
<tr class="separator:afeae6138da019624fe8e5db69a5af620"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a891cd5588d8a3a45bd2937e73609d81c" id="r_a891cd5588d8a3a45bd2937e73609d81c"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a891cd5588d8a3a45bd2937e73609d81c">__calloc_a</a> (size_t len,...)</td></tr>
<tr class="separator:a891cd5588d8a3a45bd2937e73609d81c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a386290589e6f29b2efd0afb7ab35f7f7" id="r_a386290589e6f29b2efd0afb7ab35f7f7"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a386290589e6f29b2efd0afb7ab35f7f7">cbuf_alloc</a> (unsigned int order)</td></tr>
<tr class="separator:a386290589e6f29b2efd0afb7ab35f7f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca456ac971e215a702c25210eab60228" id="r_aca456ac971e215a702c25210eab60228"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aca456ac971e215a702c25210eab60228">cbuf_free</a> (void *ptr, unsigned int order)</td></tr>
<tr class="separator:aca456ac971e215a702c25210eab60228"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fb089901b41392a5ac197f3e18cc3f7" id="r_a9fb089901b41392a5ac197f3e18cc3f7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9fb089901b41392a5ac197f3e18cc3f7">mkdir_p</a> (char *dir, mode_t mask)</td></tr>
<tr class="separator:a9fb089901b41392a5ac197f3e18cc3f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ac75d395c5362b1ab5bfa39b46c2a318b" name="ac75d395c5362b1ab5bfa39b46c2a318b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac75d395c5362b1ab5bfa39b46c2a318b">&#9670;&#160;</a></span>C_PTR_ALIGN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define C_PTR_ALIGN&#160;&#160;&#160;(sizeof(size_t))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d0/d2b/libubox_2utils_8c_source.html#l00032">32</a> of file <a class="el" href="../../d0/d2b/libubox_2utils_8c_source.html">utils.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d0/d2b/libubox_2utils_8c_source.html#l00035">__calloc_a()</a>.</p>

</div>
</div>
<a id="afeae6138da019624fe8e5db69a5af620" name="afeae6138da019624fe8e5db69a5af620"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afeae6138da019624fe8e5db69a5af620">&#9670;&#160;</a></span>C_PTR_MASK</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define C_PTR_MASK&#160;&#160;&#160;(-<a class="el" href="#ac75d395c5362b1ab5bfa39b46c2a318b">C_PTR_ALIGN</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d0/d2b/libubox_2utils_8c_source.html#l00033">33</a> of file <a class="el" href="../../d0/d2b/libubox_2utils_8c_source.html">utils.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d0/d2b/libubox_2utils_8c_source.html#l00035">__calloc_a()</a>.</p>

</div>
</div>
<a id="abfdb4e7955090760555ef1a81641db01" name="abfdb4e7955090760555ef1a81641db01"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abfdb4e7955090760555ef1a81641db01">&#9670;&#160;</a></span>foreach_arg</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define foreach_arg</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>_arg</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>_addr</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>_len</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>_first_addr</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>_first_len</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    <span class="keywordflow">for</span> (_addr = (_first_addr), _len = (_first_len); \</div>
<div class="line">        _addr; \</div>
<div class="line">        _addr = va_arg(_arg, <span class="keywordtype">void</span> **), _len = _addr ? va_arg(_arg, <span class="keywordtype">size_t</span>) : 0)</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="../../d0/d2b/libubox_2utils_8c_source.html#l00027">27</a> of file <a class="el" href="../../d0/d2b/libubox_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   27</span><span class="preprocessor">#define foreach_arg(_arg, _addr, _len, _first_addr, _first_len) \</span></div>
<div class="line"><span class="lineno">   28</span><span class="preprocessor">    for (_addr = (_first_addr), _len = (_first_len); \</span></div>
<div class="line"><span class="lineno">   29</span><span class="preprocessor">        _addr; \</span></div>
<div class="line"><span class="lineno">   30</span><span class="preprocessor">        _addr = va_arg(_arg, void **), _len = _addr ? va_arg(_arg, size_t) : 0)</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="../../d0/d2b/libubox_2utils_8c_source.html#l00035">__calloc_a()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a891cd5588d8a3a45bd2937e73609d81c" name="a891cd5588d8a3a45bd2937e73609d81c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a891cd5588d8a3a45bd2937e73609d81c">&#9670;&#160;</a></span>__calloc_a()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void * __calloc_a </td>
          <td>(</td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>len</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>...</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d0/d2b/libubox_2utils_8c_source.html#l00035">35</a> of file <a class="el" href="../../d0/d2b/libubox_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   36</span>{</div>
<div class="line"><span class="lineno">   37</span>    va_list ap, ap1;</div>
<div class="line"><span class="lineno">   38</span>    <span class="keywordtype">void</span> *ret;</div>
<div class="line"><span class="lineno">   39</span>    <span class="keywordtype">void</span> **cur_addr;</div>
<div class="line"><span class="lineno">   40</span>    <span class="keywordtype">size_t</span> cur_len;</div>
<div class="line"><span class="lineno">   41</span>    <span class="keywordtype">int</span> alloc_len = 0;</div>
<div class="line"><span class="lineno">   42</span>    <span class="keywordtype">char</span> *ptr;</div>
<div class="line"><span class="lineno">   43</span> </div>
<div class="line"><span class="lineno">   44</span>    va_start(ap, len);</div>
<div class="line"><span class="lineno">   45</span> </div>
<div class="line"><span class="lineno">   46</span>    va_copy(ap1, ap);</div>
<div class="line"><span class="lineno">   47</span>    <a class="code hl_define" href="#abfdb4e7955090760555ef1a81641db01">foreach_arg</a>(ap1, cur_addr, cur_len, &amp;ret, len)</div>
<div class="line"><span class="lineno">   48</span>        alloc_len += (cur_len + <a class="code hl_define" href="#ac75d395c5362b1ab5bfa39b46c2a318b">C_PTR_ALIGN</a> - 1 ) &amp; <a class="code hl_define" href="#afeae6138da019624fe8e5db69a5af620">C_PTR_MASK</a>;</div>
<div class="line"><span class="lineno">   49</span>    va_end(ap1);</div>
<div class="line"><span class="lineno">   50</span> </div>
<div class="line"><span class="lineno">   51</span>    ptr = calloc(1, alloc_len);</div>
<div class="line"><span class="lineno">   52</span>    <span class="keywordflow">if</span> (!ptr) {</div>
<div class="line"><span class="lineno">   53</span>        va_end(ap);</div>
<div class="line"><span class="lineno">   54</span>        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">   55</span>    }</div>
<div class="line"><span class="lineno">   56</span> </div>
<div class="line"><span class="lineno">   57</span>    alloc_len = 0;</div>
<div class="line"><span class="lineno">   58</span>    <a class="code hl_define" href="#abfdb4e7955090760555ef1a81641db01">foreach_arg</a>(ap, cur_addr, cur_len, &amp;ret, len) {</div>
<div class="line"><span class="lineno">   59</span>        *cur_addr = &amp;ptr[alloc_len];</div>
<div class="line"><span class="lineno">   60</span>        alloc_len += (cur_len + <a class="code hl_define" href="#ac75d395c5362b1ab5bfa39b46c2a318b">C_PTR_ALIGN</a> - 1) &amp; <a class="code hl_define" href="#afeae6138da019624fe8e5db69a5af620">C_PTR_MASK</a>;</div>
<div class="line"><span class="lineno">   61</span>    }</div>
<div class="line"><span class="lineno">   62</span>    va_end(ap);</div>
<div class="line"><span class="lineno">   63</span> </div>
<div class="line"><span class="lineno">   64</span>    <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">   65</span>}</div>
<div class="ttc" id="alibubox_2utils_8c_html_abfdb4e7955090760555ef1a81641db01"><div class="ttname"><a href="#abfdb4e7955090760555ef1a81641db01">foreach_arg</a></div><div class="ttdeci">#define foreach_arg(_arg, _addr, _len, _first_addr, _first_len)</div><div class="ttdef"><b>Definition</b> <a href="../../d0/d2b/libubox_2utils_8c_source.html#l00027">utils.c:27</a></div></div>
<div class="ttc" id="alibubox_2utils_8c_html_ac75d395c5362b1ab5bfa39b46c2a318b"><div class="ttname"><a href="#ac75d395c5362b1ab5bfa39b46c2a318b">C_PTR_ALIGN</a></div><div class="ttdeci">#define C_PTR_ALIGN</div><div class="ttdef"><b>Definition</b> <a href="../../d0/d2b/libubox_2utils_8c_source.html#l00032">utils.c:32</a></div></div>
<div class="ttc" id="alibubox_2utils_8c_html_afeae6138da019624fe8e5db69a5af620"><div class="ttname"><a href="#afeae6138da019624fe8e5db69a5af620">C_PTR_MASK</a></div><div class="ttdeci">#define C_PTR_MASK</div><div class="ttdef"><b>Definition</b> <a href="../../d0/d2b/libubox_2utils_8c_source.html#l00033">utils.c:33</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d0/d2b/libubox_2utils_8c_source.html#l00032">C_PTR_ALIGN</a>, <a class="el" href="../../d0/d2b/libubox_2utils_8c_source.html#l00033">C_PTR_MASK</a>, and <a class="el" href="../../d0/d2b/libubox_2utils_8c_source.html#l00027">foreach_arg</a>.</p>

</div>
</div>
<a id="a386290589e6f29b2efd0afb7ab35f7f7" name="a386290589e6f29b2efd0afb7ab35f7f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a386290589e6f29b2efd0afb7ab35f7f7">&#9670;&#160;</a></span>cbuf_alloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void * cbuf_alloc </td>
          <td>(</td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>order</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d0/d2b/libubox_2utils_8c_source.html#l00116">116</a> of file <a class="el" href="../../d0/d2b/libubox_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  117</span>{</div>
<div class="line"><span class="lineno">  118</span>    <span class="keywordtype">char</span> <a class="code hl_variable" href="../../df/d0e/ubusd__obj_8c.html#a9ece2e576492090c46d5e3b435cef7d4">path</a>[] = <span class="stringliteral">&quot;/tmp/cbuf-XXXXXX&quot;</span>;</div>
<div class="line"><span class="lineno">  119</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> size = <a class="code hl_function" href="../../d5/d1d/libubox_2utils_8h.html#a88be6bc7dda9ab3b8bd610efec7662bc">cbuf_size</a>(order);</div>
<div class="line"><span class="lineno">  120</span>    <span class="keywordtype">void</span> *ret = NULL;</div>
<div class="line"><span class="lineno">  121</span>    <span class="keywordtype">int</span> fd;</div>
<div class="line"><span class="lineno">  122</span> </div>
<div class="line"><span class="lineno">  123</span>    fd = mkstemp(<a class="code hl_variable" href="../../df/d0e/ubusd__obj_8c.html#a9ece2e576492090c46d5e3b435cef7d4">path</a>);</div>
<div class="line"><span class="lineno">  124</span>    <span class="keywordflow">if</span> (fd &lt; 0)</div>
<div class="line"><span class="lineno">  125</span>        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  126</span> </div>
<div class="line"><span class="lineno">  127</span>    <span class="keywordflow">if</span> (unlink(<a class="code hl_variable" href="../../df/d0e/ubusd__obj_8c.html#a9ece2e576492090c46d5e3b435cef7d4">path</a>))</div>
<div class="line"><span class="lineno">  128</span>        <span class="keywordflow">goto</span> close;</div>
<div class="line"><span class="lineno">  129</span> </div>
<div class="line"><span class="lineno">  130</span>    <span class="keywordflow">if</span> (ftruncate(fd, <a class="code hl_function" href="../../d5/d1d/libubox_2utils_8h.html#a88be6bc7dda9ab3b8bd610efec7662bc">cbuf_size</a>(order)))</div>
<div class="line"><span class="lineno">  131</span>        <span class="keywordflow">goto</span> close;</div>
<div class="line"><span class="lineno">  132</span> </div>
<div class="line"><span class="lineno">  133</span><span class="preprocessor">#ifndef MAP_ANONYMOUS</span></div>
<div class="line"><span class="lineno">  134</span><span class="preprocessor">#define MAP_ANONYMOUS MAP_ANON</span></div>
<div class="line"><span class="lineno">  135</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  136</span> </div>
<div class="line"><span class="lineno">  137</span>    ret = mmap(NULL, size * 2, PROT_NONE, MAP_ANON | MAP_PRIVATE, -1, 0);</div>
<div class="line"><span class="lineno">  138</span>    <span class="keywordflow">if</span> (ret == MAP_FAILED) {</div>
<div class="line"><span class="lineno">  139</span>        ret = NULL;</div>
<div class="line"><span class="lineno">  140</span>        <span class="keywordflow">goto</span> close;</div>
<div class="line"><span class="lineno">  141</span>    }</div>
<div class="line"><span class="lineno">  142</span> </div>
<div class="line"><span class="lineno">  143</span>    <span class="keywordflow">if</span> (mmap(ret, size, PROT_READ | PROT_WRITE, MAP_FIXED | MAP_SHARED,</div>
<div class="line"><span class="lineno">  144</span>         fd, 0) != ret ||</div>
<div class="line"><span class="lineno">  145</span>        mmap(ret + size, size, PROT_READ | PROT_WRITE,</div>
<div class="line"><span class="lineno">  146</span>         MAP_FIXED | MAP_SHARED, fd, 0) != ret + size) {</div>
<div class="line"><span class="lineno">  147</span>        munmap(ret, size * 2);</div>
<div class="line"><span class="lineno">  148</span>        ret = NULL;</div>
<div class="line"><span class="lineno">  149</span>    }</div>
<div class="line"><span class="lineno">  150</span> </div>
<div class="line"><span class="lineno">  151</span>close:</div>
<div class="line"><span class="lineno">  152</span>    close(fd);</div>
<div class="line"><span class="lineno">  153</span>    <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">  154</span>}</div>
<div class="ttc" id="alibubox_2utils_8h_html_a88be6bc7dda9ab3b8bd610efec7662bc"><div class="ttname"><a href="../../d5/d1d/libubox_2utils_8h.html#a88be6bc7dda9ab3b8bd610efec7662bc">cbuf_size</a></div><div class="ttdeci">static unsigned long cbuf_size(int order)</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d1d/libubox_2utils_8h_source.html#l00255">utils.h:255</a></div></div>
<div class="ttc" id="aubusd__obj_8c_html_a9ece2e576492090c46d5e3b435cef7d4"><div class="ttname"><a href="../../df/d0e/ubusd__obj_8c.html#a9ece2e576492090c46d5e3b435cef7d4">path</a></div><div class="ttdeci">struct avl_tree path</div><div class="ttdef"><b>Definition</b> <a href="../../df/d0e/ubusd__obj_8c_source.html#l00019">ubusd_obj.c:19</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d5/d1d/libubox_2utils_8h_source.html#l00255">cbuf_size()</a>, and <a class="el" href="../../df/d0e/ubusd__obj_8c_source.html#l00019">path</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d0/d2b/libubox_2utils_8c_a386290589e6f29b2efd0afb7ab35f7f7_cgraph.png" border="0" usemap="#ad0/d2b/libubox_2utils_8c_a386290589e6f29b2efd0afb7ab35f7f7_cgraph" alt=""/></div>
<map name="ad0/d2b/libubox_2utils_8c_a386290589e6f29b2efd0afb7ab35f7f7_cgraph" id="ad0/d2b/libubox_2utils_8c_a386290589e6f29b2efd0afb7ab35f7f7_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,119,39"/>
<area shape="rect" href="../../d5/d1d/libubox_2utils_8h.html#a88be6bc7dda9ab3b8bd610efec7662bc" title=" " alt="" coords="167,5,274,39"/>
<area shape="poly" title=" " alt="" coords="119,20,151,20,151,25,119,25"/>
</map>
</div>

</div>
</div>
<a id="aca456ac971e215a702c25210eab60228" name="aca456ac971e215a702c25210eab60228"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca456ac971e215a702c25210eab60228">&#9670;&#160;</a></span>cbuf_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cbuf_free </td>
          <td>(</td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>ptr</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>order</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d0/d2b/libubox_2utils_8c_source.html#l00156">156</a> of file <a class="el" href="../../d0/d2b/libubox_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  157</span>{</div>
<div class="line"><span class="lineno">  158</span>    munmap(ptr, <a class="code hl_function" href="../../d5/d1d/libubox_2utils_8h.html#a88be6bc7dda9ab3b8bd610efec7662bc">cbuf_size</a>(order) * 2);</div>
<div class="line"><span class="lineno">  159</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d5/d1d/libubox_2utils_8h_source.html#l00255">cbuf_size()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d0/d2b/libubox_2utils_8c_aca456ac971e215a702c25210eab60228_cgraph.png" border="0" usemap="#ad0/d2b/libubox_2utils_8c_aca456ac971e215a702c25210eab60228_cgraph" alt=""/></div>
<map name="ad0/d2b/libubox_2utils_8c_aca456ac971e215a702c25210eab60228_cgraph" id="ad0/d2b/libubox_2utils_8c_aca456ac971e215a702c25210eab60228_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,113,39"/>
<area shape="rect" href="../../d5/d1d/libubox_2utils_8h.html#a88be6bc7dda9ab3b8bd610efec7662bc" title=" " alt="" coords="161,5,268,39"/>
<area shape="poly" title=" " alt="" coords="113,20,145,20,145,25,113,25"/>
</map>
</div>

</div>
</div>
<a id="a9fb089901b41392a5ac197f3e18cc3f7" name="a9fb089901b41392a5ac197f3e18cc3f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9fb089901b41392a5ac197f3e18cc3f7">&#9670;&#160;</a></span>mkdir_p()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mkdir_p </td>
          <td>(</td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>dir</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mode_t</td>          <td class="paramname"><span class="paramname"><em>mask</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d0/d2b/libubox_2utils_8c_source.html#l00161">161</a> of file <a class="el" href="../../d0/d2b/libubox_2utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  162</span>{</div>
<div class="line"><span class="lineno">  163</span>    <span class="keywordtype">char</span> *l;</div>
<div class="line"><span class="lineno">  164</span>    <span class="keywordtype">int</span> ret;</div>
<div class="line"><span class="lineno">  165</span> </div>
<div class="line"><span class="lineno">  166</span>    ret = mkdir(dir, mask);</div>
<div class="line"><span class="lineno">  167</span>    <span class="keywordflow">if</span> (!ret || errno == EEXIST)</div>
<div class="line"><span class="lineno">  168</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  169</span> </div>
<div class="line"><span class="lineno">  170</span>    <span class="keywordflow">if</span> (ret &amp;&amp; (errno != ENOENT))</div>
<div class="line"><span class="lineno">  171</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  172</span> </div>
<div class="line"><span class="lineno">  173</span>    l = strrchr(dir, <span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line"><span class="lineno">  174</span>    <span class="keywordflow">if</span> (!l || l == dir)</div>
<div class="line"><span class="lineno">  175</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  176</span> </div>
<div class="line"><span class="lineno">  177</span>    *l = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  178</span> </div>
<div class="line"><span class="lineno">  179</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a9fb089901b41392a5ac197f3e18cc3f7">mkdir_p</a>(dir, mask))</div>
<div class="line"><span class="lineno">  180</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  181</span> </div>
<div class="line"><span class="lineno">  182</span>    *l = <span class="charliteral">&#39;/&#39;</span>;</div>
<div class="line"><span class="lineno">  183</span> </div>
<div class="line"><span class="lineno">  184</span>    ret = mkdir(dir, mask);</div>
<div class="line"><span class="lineno">  185</span>    <span class="keywordflow">if</span> (!ret || errno == EEXIST)</div>
<div class="line"><span class="lineno">  186</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  187</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  188</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  189</span>}</div>
<div class="ttc" id="alibubox_2utils_8c_html_a9fb089901b41392a5ac197f3e18cc3f7"><div class="ttname"><a href="#a9fb089901b41392a5ac197f3e18cc3f7">mkdir_p</a></div><div class="ttdeci">int mkdir_p(char *dir, mode_t mask)</div><div class="ttdef"><b>Definition</b> <a href="../../d0/d2b/libubox_2utils_8c_source.html#l00161">utils.c:161</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d0/d2b/libubox_2utils_8c_source.html#l00161">mkdir_p()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d26/jail_8c_source.html#l00679">build_jail_fs()</a>, <a class="el" href="../../db/d40/cgroups_8c_source.html#l00102">cgroups_apply()</a>, <a class="el" href="../../dd/d26/jail_8c_source.html#l00592">create_devices()</a>, <a class="el" href="../../d2/d5a/fs_8c_source.html#l00058">do_mount()</a>, <a class="el" href="../../da/d37/hotplug_8c_source.html#l00136">handle_makedev()</a>, <a class="el" href="../../db/d3d/netifd_8c_source.html#l00434">jail_network_start()</a>, <a class="el" href="../../d0/d2b/libubox_2utils_8c_source.html#l00161">mkdir_p()</a>, <a class="el" href="../../dd/d26/jail_8c_source.html#l00288">mount_overlay()</a>, and <a class="el" href="../../dd/d26/jail_8c_source.html#l02923">post_main()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d0/d2b/libubox_2utils_8c_a9fb089901b41392a5ac197f3e18cc3f7_cgraph.png" border="0" usemap="#ad0/d2b/libubox_2utils_8c_a9fb089901b41392a5ac197f3e18cc3f7_cgraph" alt=""/></div>
<map name="ad0/d2b/libubox_2utils_8c_a9fb089901b41392a5ac197f3e18cc3f7_cgraph" id="ad0/d2b/libubox_2utils_8c_a9fb089901b41392a5ac197f3e18cc3f7_cgraph">
<area shape="rect" title=" " alt="" coords="5,29,102,63"/>
<area shape="poly" title=" " alt="" coords="35,29,35,12,42,5,54,3,65,5,72,12,68,16,63,10,53,8,45,10,40,14,40,29"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
